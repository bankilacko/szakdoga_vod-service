<div class="comment-section">
  <h3 class="comments-title">Comments</h3>
  
  <!-- New comment form (only for logged in users) -->
  <div class="new-comment" *ngIf="isLoggedIn">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Write a comment...</mat-label>
      <textarea 
        matInput 
        [(ngModel)]="newComment" 
        placeholder="Share your thoughts about this video..."
        rows="3"
        maxlength="500">
      </textarea>
      <mat-hint align="end">{{ newComment.length }}/500</mat-hint>
    </mat-form-field>
    
    <div class="comment-actions">
      <button 
        mat-raised-button 
        color="primary" 
        (click)="addComment()"
        [disabled]="!newComment.trim() || isSubmitting">
        <mat-icon>send</mat-icon>
        Post Comment
      </button>
    </div>
  </div>

  <!-- Comments list -->
  <div class="comments-list">
    <div *ngIf="isLoading" class="loading">
      <mat-spinner diameter="30"></mat-spinner>
      <p>Loading comments...</p>
    </div>
    
    <div *ngIf="comments.length === 0" class="no-comments">
      <p>No comments yet. Be the first to comment!</p>
    </div>
    
    <div *ngFor="let comment of comments" class="comment">
      <div class="comment-header">
        <div class="comment-author">
          <mat-icon>person</mat-icon>
          <strong>{{ comment.username }}</strong>
        </div>
        <div class="comment-meta">
          <span class="comment-date">{{ formatDate(comment.created_at) }}</span>
        </div>
      </div>
      
      <div class="comment-content-row" *ngIf="editingCommentId !== comment.id">
        <div class="comment-content">
          {{ comment.content }}
        </div>
        <div class="comment-actions" *ngIf="canEdit(comment) || canDelete(comment)">
          <button 
            *ngIf="canEdit(comment)"
            mat-icon-button 
            (click)="startEdit(comment)"
            [disabled]="isSubmitting"
            title="Edit comment"
            style="display: inline-block !important; visibility: visible !important; opacity: 1 !important;">
            <mat-icon>edit</mat-icon>
          </button>
          <button 
            *ngIf="canDelete(comment)"
            mat-icon-button 
            color="warn"
            (click)="confirmDelete(comment.id)"
            [disabled]="isSubmitting"
            title="Delete comment"
            style="display: inline-block !important; visibility: visible !important; opacity: 1 !important;">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      
      <!-- Edit mode -->
      <div class="edit-comment" *ngIf="editingCommentId === comment.id">
        <mat-form-field appearance="outline" class="full-width">
          <textarea 
            matInput 
            [(ngModel)]="editingContent" 
            rows="3"
            maxlength="500">
          </textarea>
          <mat-hint align="end">{{ editingContent.length }}/500</mat-hint>
        </mat-form-field>
        <div class="edit-actions">
          <button 
            mat-raised-button 
            color="primary" 
            (click)="saveEdit(comment.id)"
            [disabled]="!editingContent.trim() || isSubmitting">
            Save
          </button>
          <button 
            mat-button 
            (click)="cancelEdit()">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete confirmation modal -->
  <div class="delete-modal" *ngIf="showDeleteModal">
    <div class="delete-modal-content">
      <h3>Delete Comment</h3>
      <p>Are you sure you want to delete this comment? This action cannot be undone.</p>
      <div class="delete-modal-actions">
        <button mat-button (click)="cancelDelete()">Cancel</button>
        <button mat-raised-button color="warn" (click)="deleteComment(commentToDelete!)" [disabled]="isSubmitting">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>
